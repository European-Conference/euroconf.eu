<div class="schedule-slot">
  <span class="time"> {{ .slot.time }} </span>
  <div class="schedule-events">
    {{ range .slot.events }}
      {{$speakerLinks := slice}}
    
      {{ $pages := (where $.root.Site.RegularPages "Section" "speakers") }} 
      {{ $bridge := (where $pages "Params.panel" .code) }}
      {{ $speakers := (where $bridge "Params.moderator" "!=" true) }}
      {{ range $speakers}}
        {{ if eq .Params.show true }}
          {{ $speakerLinks = $speakerLinks | append (printf "<a href='%s'>%s</a>" .RelPermalink .Params.name) }}
        {{ else }}
          {{ $speakerLinks = $speakerLinks | append (printf "%s" .Params.name) }}
        {{end}}
      {{end}}

      {{ $pagesTwo := (where $pages "Params.panelTwo" nil) }} 
      {{ $pagesTwo }}
      {{ $bridgeTwo := (where $pagesTwo "Params.panelTwo" .code) }}
      {{ $bridgeTwo }}
      {{ $speakersTwo := (where $bridgeTwo "Params.moderator" "!=" true) }}
      {{ $speakersTwo }}
      {{ range $speakersTwo}}
        {{ if eq .Params.show true }}
          {{ $speakerLinks = $speakerLinks | append (printf "<a href='%s'>%s</a>" .RelPermalink .Params.name) }}
        {{ else }}
          {{ $speakerLinks = $speakerLinks | append (printf "%s" .Params.name) }}
        {{end}}
      {{end}}

      {{ $pagesKeynote := (where $pages "Params.keynote" "!=" nil) }} 
      {{ $bridgeKeynote := (where $pages "Params.keynote" .keynote) }}
      {{ $speakersKeynote := (where $bridgeKeynote "Params.moderator" "!=" true) }}
      {{ range $speakersKeynote}}
        {{ if eq .Params.show true }}
          {{ $speakerLinks = $speakerLinks | append (printf "<a href='%s'>%s</a>" .RelPermalink .Params.name) }}
        {{ else }}
          {{ $speakerLinks = $speakerLinks | append (printf "%s" .Params.name) }}
        {{end}}
      {{end}}
    
      <div class="schedule-event {{ .type }}">
        <div class="event-info">
          {{ if eq .type "keynote"}}
            <span class="event-type-tag">Keynote Address</span><br />
          {{end}}
          {{ if eq .type "panel"}}
            <span class="event-type-tag">Panel</span><br />
          {{end}}
          {{ if eq .type "workshop"}}
            <span class="event-type-tag">Workshop</span><br />
          {{end}}
          <span class="event-title"> 
            {{.content | safeHTML}} 
          </span>
          <span class="event-speakers">
            {{ range $key, $value := $speakerLinks}}
              {{if $key}}
                |
              {{end}}
              {{safeHTML $value}}
            {{end}}
          </span>
          
          <span class="event-moderators">
            {{ if in .slot.event.moderator " " }}
              Moderated by {{.moderator | safeHTML}}
            {{ else }}
              {{ $pages := (where $.root.Site.RegularPages "Section" "speakers") }}
              {{ $moderators := (where $pages "File.ContentBaseName" .moderator) }}
              {{ $moderator := index $moderators 0}}
              {{ if $moderator }}
                {{ $moderatorLink := printf "<a href='%s'>%s</a>" $moderator.RelPermalink $moderator.Params.name}}
                {{ $moderatorText := "Moderated by "}}
                {{ if .moderatorText }}
                  {{ $moderatorText = .moderatorText }}
                {{ end }}
                {{$moderatorText}}
                {{ safeHTML $moderatorLink }}
              {{ end }}
            {{ end }}
          </span>
        </div>
        
        <div class="event-location"> 
          {{ .location }} 
        </div>
      </div>
    {{end}}
  </div>
</div>
