<div class="schedule-slot">
  <span class="time"> {{ .slot.time }} </span>
  <div class="schedule-events">
    {{$speakerLinks := slice}}
    {{ range .slot.events }}
      {{ $pages := (where $.root.Site.RegularPages "Section" "speakers") }} 
      {{ $speakers := (where $pages "Params.panel" .code) }} 
      {{ $speaker := index $speakers 0}}
      {{ $speaker }}
      {{ if $speaker }}
        {{ $speakerLinks = $speakerLinks | append (printf "<a href='%s'>%s</a>" $speaker.RelPermalink $speaker.Params.name) }}
      {{end}}
    
      <div class="schedule-event {{ .event.type }}">
        <div class="event-info">
          {{ if eq .slot.event.type "keynote"}}
            <span class="event-type-tag">Keynote Address</span><br />
          {{end}}
          {{ if eq .slot.event.type "panel"}}
            <span class="event-type-tag">Panel</span><br />
          {{end}}
          {{ if eq .slot.event.type "workshop"}}
            <span class="event-type-tag">Workshop</span><br />
          {{end}}
          <span class="event-title"> 
            {{.slot.event.content | safeHTML}} 
          </span>
          <span class="event-speakers">
            {{ range $key, $value := $.speakerLinks}}
              {{if $key}}
                |
              {{end}}
              {{safeHTML $value}}
            {{end}}
          </span>
          
          <span class="event-moderators">
            {{ if in .slot.event.moderator " " }}
              Moderated by {{.slot.event.moderator | safeHTML}}
            {{ else }}
              {{ $pages := (where $.root.Site.RegularPages "Section" "speakers") }}
              {{ $moderators := (where $pages "File.ContentBaseName" .slot.event.moderator) }}
              {{ $moderator := index $moderators 0}}
              {{ if $moderator }}
                {{ $moderatorLink := printf "<a href='%s'>%s</a>" $moderator.RelPermalink $moderator.Params.name}}
                {{ $moderatorText := "Moderated by "}}
                {{ if .slot.event.moderatorText }}
                  {{ $moderatorText = .slot.event.moderatorText }}
                {{ end }}
                {{$moderatorText}}
                {{ safeHTML $moderatorLink }}
              {{ end }}
            {{ end }}
          </span>
        </div>
        <div class="event-location"> 
          {{ .slot.event.location }} 
        </div>
      </div>
    {{end}}
  </div>
</div>
